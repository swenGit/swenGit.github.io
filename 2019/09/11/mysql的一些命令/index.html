<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="mysql的一些命令,容易忘记的添加索引123alter table 表名 add [unique | primary] index 索引名 (索引字段[, 字段2]);-- 索引名 和 索引字段 都不用加 &apos;&apos;-- primary 的话字段必须为 not null  删除索引1alter table 表名 drop index 索引名 -- 唯一索引也是用index  更改索引1alter ta">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/2019/09/11/mysql的一些命令/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="mysql的一些命令,容易忘记的添加索引123alter table 表名 add [unique | primary] index 索引名 (索引字段[, 字段2]);-- 索引名 和 索引字段 都不用加 &apos;&apos;-- primary 的话字段必须为 not null  删除索引1alter table 表名 drop index 索引名 -- 唯一索引也是用index  更改索引1alter ta">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-09-10T10:14:17.958Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="mysql的一些命令,容易忘记的添加索引123alter table 表名 add [unique | primary] index 索引名 (索引字段[, 字段2]);-- 索引名 和 索引字段 都不用加 &apos;&apos;-- primary 的话字段必须为 not null  删除索引1alter table 表名 drop index 索引名 -- 唯一索引也是用index  更改索引1alter ta">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-mysql的一些命令" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/11/mysql的一些命令/" class="article-date">
  <time datetime="2019-09-11T14:34:13.828Z" itemprop="datePublished">2019-09-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="mysql的一些命令-容易忘记的"><a href="#mysql的一些命令-容易忘记的" class="headerlink" title="mysql的一些命令,容易忘记的"></a>mysql的一些命令,容易忘记的</h2><h4 id="添加索引"><a href="#添加索引" class="headerlink" title="添加索引"></a>添加索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> [<span class="keyword">unique</span> | primary] <span class="keyword">index</span> 索引名 (索引字段[, 字段<span class="number">2</span>]);</span><br><span class="line"><span class="comment">-- 索引名 和 索引字段 都不用加 ''</span></span><br><span class="line"><span class="comment">-- primary 的话字段必须为 not null</span></span><br></pre></td></tr></table></figure>

<h4 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> <span class="keyword">index</span> 索引名 <span class="comment">-- 唯一索引也是用index</span></span><br></pre></td></tr></table></figure>

<h4 id="更改索引"><a href="#更改索引" class="headerlink" title="更改索引"></a>更改索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> <span class="keyword">index</span> 索引名 , <span class="keyword">add</span> <span class="keyword">unique</span> <span class="keyword">index</span> 索引名 (索引字段)</span><br></pre></td></tr></table></figure>

<h4 id="建表的时候添加普通索引"><a href="#建表的时候添加普通索引" class="headerlink" title="建表的时候添加普通索引"></a>建表的时候添加普通索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在<span class="keyword">create</span> <span class="keyword">table</span> ... (</span><br><span class="line">	中,添加一行</span><br><span class="line">    <span class="keyword">index</span> 索引名 (索引字段)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="建表的时候添加唯一索引"><a href="#建表的时候添加唯一索引" class="headerlink" title="建表的时候添加唯一索引"></a>建表的时候添加唯一索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在<span class="keyword">create</span> <span class="keyword">table</span> ... (</span><br><span class="line">	中,添加一行</span><br><span class="line">    <span class="keyword">unique</span> <span class="keyword">key</span> 索引名 (索引字段)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="建表的时候添加主键"><a href="#建表的时候添加主键" class="headerlink" title="建表的时候添加主键"></a>建表的时候添加主键</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在<span class="keyword">create</span> <span class="keyword">table</span> ... (</span><br><span class="line">	中,添加一行</span><br><span class="line">    primary <span class="keyword">key</span> (索引字段)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="查询的时候指定索引"><a href="#查询的时候指定索引" class="headerlink" title="查询的时候指定索引"></a>查询的时候指定索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">force</span> <span class="keyword">index</span> (idx_rc) <span class="keyword">where</span> cust_id = <span class="string">'666'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="多表查询的时候指定驱动表"><a href="#多表查询的时候指定驱动表" class="headerlink" title="多表查询的时候指定驱动表"></a>多表查询的时候指定驱动表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> s1 straigt_join s2 <span class="keyword">on</span> s1.id = s2.id <span class="keyword">where</span> s2.num &gt; <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<h4 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> 表名</span><br></pre></td></tr></table></figure>

<h4 id="使用json显示执行计划"><a href="#使用json显示执行计划" class="headerlink" title="使用json显示执行计划"></a>使用json显示执行计划</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">format</span> = <span class="keyword">json</span> <span class="keyword">select</span> * <span class="keyword">from</span>  表 <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h4 id="建表的时候自动更新日期"><a href="#建表的时候自动更新日期" class="headerlink" title="建表的时候自动更新日期"></a>建表的时候自动更新日期</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> ... (</span><br><span class="line">	中,添加一行</span><br><span class="line">    <span class="string">"update_time"</span> datetime(<span class="number">3</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>(<span class="number">3</span>) <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>(<span class="number">3</span>) <span class="keyword">COMMENT</span> <span class="string">'更新时间'</span> </span><br><span class="line">)</span><br><span class="line"><span class="comment">-- datetime(3)表示 '2019-07-08 10:52:30.233' ,参数3表示秒的精度为0.001s</span></span><br><span class="line"><span class="comment">-- datetime()对应的java类型为sql.Date</span></span><br><span class="line"><span class="comment">-- DEFAULT CURRENT_TIMESTAMP(3) 表示创建的时候默认值为数据库服务器当前时间</span></span><br><span class="line"><span class="comment">-- ON UPDATE CURRENT_TIMESTAMP(3) 表示每次更新记录时都会自动更新update_time字段,更新为数据库服务器当前时间</span></span><br></pre></td></tr></table></figure>

<h4 id="数字格式的字段表示方法"><a href="#数字格式的字段表示方法" class="headerlink" title="数字格式的字段表示方法"></a>数字格式的字段表示方法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">money decimal(12,2) not null default 0.00</span><br><span class="line"><span class="comment">-- 其中12表示有效数字为12,它的取值范围为1-65</span></span><br><span class="line"><span class="comment">-- 2表示小数精度为0.01,要求比12要小, 加起来就是取值范围为 -9999999999.99~(10个9).99</span></span><br><span class="line"><span class="comment">-- 字段占用空间大小为: 从小数点分割,每9个数字一组,占用空间为 n个数/2 向上取整,最大值为4</span></span><br><span class="line">   9 999999999 . 99</span><br><span class="line"><span class="comment">-- 所以money占用长度为6</span></span><br></pre></td></tr></table></figure>

<h4 id="导出数据到txt中"><a href="#导出数据到txt中" class="headerlink" title="导出数据到txt中"></a>导出数据到txt中</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select * from 表名 </span><br><span class="line">into outfile &apos;/路径/文件名&apos;</span><br><span class="line">CHARACTER SET UTF8</span><br><span class="line">fields </span><br><span class="line">	terminated by &apos;|&apos;</span><br><span class="line">	enclosed by &apos;&quot;&apos;</span><br><span class="line">lines </span><br><span class="line">	terminated by &apos;\r\n&apos;</span><br></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1290 - The MySQL server is running with the --secure-file-priv option so it cannot execute this statement</span><br><span class="line">权限不够</span><br><span class="line">--------</span><br><span class="line">先查看 权限 show variables like &apos;%secure%&apos; </span><br><span class="line">于version&gt;5.7.6, 有效值为 &apos;&apos; , NULL, 文件路径</span><br><span class="line">修改 my.cnf 或者 my.ini , secure-file-priv=&quot;&quot;</span><br></pre></td></tr></table></figure>

<h4 id="mysql导入txt中的数据"><a href="#mysql导入txt中的数据" class="headerlink" title="mysql导入txt中的数据"></a>mysql导入txt中的数据</h4><h5 id="1-mysqlimport"><a href="#1-mysqlimport" class="headerlink" title="1. mysqlimport"></a>1. mysqlimport</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqlimport -uusername <span class="comment">--local dbName test.sql --fields-terminated-by="|"</span></span><br><span class="line"><span class="comment">--local 从服务器绝对路径读取文件导入表dbName中</span></span><br><span class="line"><span class="comment">--fields-terminated-by=字符串：设置字段之间的分隔符，可以为单个或多个字符。默认值为制表符“\t”</span></span><br></pre></td></tr></table></figure>

<h5 id="2-LOAD-DATA-LOCAL-INFILE"><a href="#2-LOAD-DATA-LOCAL-INFILE" class="headerlink" title="2.LOAD DATA LOCAL INFILE"></a>2.LOAD DATA LOCAL INFILE</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA LOCAL INFILE &apos;/dump.txt&apos; INTO TABLE mytbl </span><br><span class="line">FIELDS TERMINATED BY &apos;|&apos; </span><br><span class="line">LINES TERMINATED BY &apos;\r\n&apos;</span><br><span class="line">-- local表示文件来自客户端,而不是服务器</span><br><span class="line">-- fields 中的TERMINATED为分割符,还有两个字段在下边的例子里有</span><br><span class="line">-- lines 和 fields都可以不写,如果写的话必须放在fields的后边</span><br><span class="line"></span><br><span class="line">load data local infile &apos;D:/my_user_info.txt&apos; into table user_info </span><br><span class="line">CHARACTER SET utf8 -- 可选，避免中文乱码问题 </span><br><span class="line">FIELDS </span><br><span class="line">	TERMINATED BY &apos;||&apos; -- 字段分隔符，每个字段(列)以什么字符分隔，默认是 \t </span><br><span class="line">	OPTIONALLY ENCLOSED BY &apos;&apos; -- 文本限定符，每个字段被什么字符包围，默认是空字符 </span><br><span class="line">	ESCAPED BY &apos;\\&apos; -- 转义符，默认是 \ </span><br><span class="line">LINES TERMINATED BY &apos;\n&apos; -- 记录分隔符，如字段本身也含\n，那么应先去除，否则load data 会误将其视作另一行记录进行导入 </span><br><span class="line">(id, name, age, address, create_date) -- 每一行文本按顺序对应的表字段，建议不要省略</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意在win环境lines为 \r\n , 在linux环境lines为 \n</p>
<p>注意:使用local会生成临时文件, 不使用local时文件唯一键冲突会停止导入,可以选择加上 replace或者ignore</p>
<p>local会一直执行load操作,不会被中断,问题数据就乱写,索引重复就跳过</p>
<p>加上replace/ignore就会中断</p>
</blockquote>
<h6 id="遇到的两个报错"><a href="#遇到的两个报错" class="headerlink" title="遇到的两个报错"></a>遇到的两个报错</h6><h6 id="Invalid-utf8-character"><a href="#Invalid-utf8-character" class="headerlink" title="Invalid utf8 character"></a>Invalid utf8 character</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1300 (HY000): Invalid utf8 character string: &apos; &apos;</span><br><span class="line">这个问题是因为infile文件出现乱码导致的</span><br><span class="line">原因是从win系统rz进去的的时候编码格式不一致导致,导之前转换一下格式</span><br></pre></td></tr></table></figure>

<h6 id="Access-denied"><a href="#Access-denied" class="headerlink" title="Access denied"></a>Access denied</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Access denied,连接被拒绝,权限不允许</span><br><span class="line">通常是因为username和password等错误</span><br><span class="line">但是这里是因为mysql用户没有file权限,可以加上local或者找root申请权限</span><br><span class="line"></span><br><span class="line">查看权限方法:</span><br><span class="line">show grants</span><br></pre></td></tr></table></figure>

<h6 id="1290-The-MySQL-server-is-running-with-the-–secure-file-priv-option-so-it-cannot-execute-this-statement"><a href="#1290-The-MySQL-server-is-running-with-the-–secure-file-priv-option-so-it-cannot-execute-this-statement" class="headerlink" title="1290 - The MySQL server is running with the –secure-file-priv option so it cannot execute this statement"></a>1290 - The MySQL server is running with the –secure-file-priv option so it cannot execute this statement</h6><h4 id="连接数据库传的参数"><a href="#连接数据库传的参数" class="headerlink" title="连接数据库传的参数"></a>连接数据库传的参数</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uusername -ppassword -hhost -Pport -e "sql语句"</span><br></pre></td></tr></table></figure>

<h4 id="中文varchar-长度"><a href="#中文varchar-长度" class="headerlink" title="中文varchar()长度"></a>中文varchar()长度</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">desc varchar(85),</span><br><span class="line">表示最多有85个 字符 ,所以中文也是最多85个,如果是utf-8就是占用最多255个字节</span><br><span class="line">实际上如果多于255个字节,每一个行格式的记录头中用于存varchar长度的字段会扩大一倍</span><br></pre></td></tr></table></figure>

<h4 id="查看全局配置-如缓冲池大小"><a href="#查看全局配置-如缓冲池大小" class="headerlink" title="查看全局配置,如缓冲池大小"></a>查看全局配置,如缓冲池大小</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'%pool_size%'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="修改全局配置-如修改隔离级别"><a href="#修改全局配置-如修改隔离级别" class="headerlink" title="修改全局配置,如修改隔离级别"></a>修改全局配置,如修改隔离级别</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> [<span class="keyword">session</span>] <span class="keyword">transaction</span> <span class="keyword">isolation</span> <span class="keyword">level</span> <span class="string">'RR'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="开启事务"><a href="#开启事务" class="headerlink" title="开启事务"></a>开启事务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SET AUTOCOMMIT=0;</span><br><span class="line">begin;</span><br><span class="line">...</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure>

<h4 id="查询1亿条记录占用的内存大小-硬盘大小"><a href="#查询1亿条记录占用的内存大小-硬盘大小" class="headerlink" title="查询1亿条记录占用的内存大小/硬盘大小"></a>查询1亿条记录占用的内存大小/硬盘大小</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df -h</span><br><span class="line">cd /mysqldata/my..1/data</span><br><span class="line">du --max-depth=1 -h</span><br></pre></td></tr></table></figure>

<h4 id="清空表记录"><a href="#清空表记录" class="headerlink" title="清空表记录"></a>清空表记录</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> 表名; <span class="comment">-- 这个不会记录日志</span></span><br></pre></td></tr></table></figure>

<h4 id="查看文件大小"><a href="#查看文件大小" class="headerlink" title="查看文件大小"></a>查看文件大小</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#找到data路径后</span></span><br><span class="line">du --max-depth=1 -h | grep uc | sort [-rn]</span><br></pre></td></tr></table></figure>

<h4 id="查询索引"><a href="#查询索引" class="headerlink" title="查询索引"></a>查询索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure>

<h4 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a>创建存储过程</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delimiter $  <span class="comment">-- 避免sql中的 ; 被识别成中断符</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> 过程名 ([proc_parameter[,...]])</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">	<span class="keyword">sql</span>语句</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line">delimiter ;  <span class="comment">-- 记得要把中断符修改回 ;</span></span><br></pre></td></tr></table></figure>

<h4 id="调用存储过程"><a href="#调用存储过程" class="headerlink" title="调用存储过程"></a>调用存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call 存储过程名(参数...) ;</span><br></pre></td></tr></table></figure>

<h4 id="查询存储过程"><a href="#查询存储过程" class="headerlink" title="查询存储过程"></a>查询存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 查询db_name数据库中的所有的存储过程</span><br><span class="line">select name from mysql.proc where db=&apos;db_name&apos;;</span><br><span class="line"></span><br><span class="line">-- 查询某个存储过程的定义</span><br><span class="line">show create procedure 过程名;</span><br></pre></td></tr></table></figure>

<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop procedure [IF EXISTS] 名字;</span><br></pre></td></tr></table></figure>

<h4 id="简单语法"><a href="#简单语法" class="headerlink" title="简单语法"></a>简单语法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE pro_test()</span><br><span class="line">BEGIN</span><br><span class="line">	declare countnum int(10);   -- declare: 声明一个int(10)型变量,可以接 default 10 来初始化</span><br><span class="line">	select count(*) into countnum from city; -- select into : 把select结果 into 到 局部变量 				countnum中</span><br><span class="line">	set countnum = countnum + 1; -- set : 给变量赋值</span><br><span class="line">	select countnum; -- 打印countnum值</span><br><span class="line">END$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; call pro_test();</span><br><span class="line">+----------+</span><br><span class="line">| countnum |</span><br><span class="line">+----------+</span><br><span class="line">|        4 |</span><br><span class="line">+----------+</span><br></pre></td></tr></table></figure>

<h4 id="传参"><a href="#传参" class="headerlink" title="传参"></a>传参</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> procedure_name([<span class="keyword">in</span>/<span class="keyword">out</span>/inout] 参数名 参数类型)</span><br><span class="line"><span class="comment">-- IN : 该参数可以作为输入，也就是需要调用方传入值 , 默认</span></span><br><span class="line"><span class="comment">-- OUT: 该参数作为输出，也就是该参数可以作为返回值</span></span><br><span class="line"><span class="comment">-- INOUT: 既可以作为输入参数，也可以作为输出参数</span></span><br></pre></td></tr></table></figure>

<p>demo</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> pro_test5(<span class="keyword">in</span> height <span class="built_in">int</span> , <span class="keyword">out</span> description <span class="built_in">varchar</span>(<span class="number">100</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">if</span> height &gt;= <span class="number">180</span> <span class="keyword">then</span> <span class="comment">-- if ... then ...</span></span><br><span class="line">		<span class="keyword">set</span> description=<span class="string">'身材高挑'</span>;</span><br><span class="line">    elseif height &gt;= 170 and height &lt; 180 then -- elseif ... then ...</span><br><span class="line">    	<span class="keyword">set</span> description=<span class="string">'标准身材'</span>;</span><br><span class="line">    else</span><br><span class="line">    	<span class="keyword">set</span> description=<span class="string">'一般身材'</span>;</span><br><span class="line">	<span class="keyword">end</span> <span class="keyword">if</span>;  <span class="comment">-- end if 这个和case when ... then ... end case 效果一样</span></span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> pro_test5(<span class="number">168</span>, @description)$</span><br><span class="line"><span class="keyword">select</span> @description$</span><br><span class="line"><span class="comment">-- @description : session变量</span></span><br><span class="line"><span class="comment">-- @@global_isolation : 系统变量</span></span><br></pre></td></tr></table></figure>

<h4 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure pro_test8(n int)</span><br><span class="line">begin</span><br><span class="line">    declare total int default 0;</span><br><span class="line">    declare num int default 1;</span><br><span class="line">    while num&lt;=n do						-- while ... do</span><br><span class="line">        set total = total + num;</span><br><span class="line">        set num = num + 1;</span><br><span class="line">    end while;							-- end while</span><br><span class="line">    select total;</span><br><span class="line">end$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>

<h4 id="存储函数"><a href="#存储函数" class="headerlink" title="存储函数"></a>存储函数</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> procedure_name([<span class="keyword">in</span>/<span class="keyword">out</span>/inout] 参数名 参数类型)</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">int</span>;		</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">declare</span> <span class="keyword">num</span> <span class="built_in">int</span> <span class="keyword">default</span> <span class="number">1</span>;</span><br><span class="line">	return num;</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"><span class="comment">-- 和存储过程相比,多了返回值类型的声明,以及返回语句</span></span><br></pre></td></tr></table></figure>

<h4 id="查询DDL"><a href="#查询DDL" class="headerlink" title="查询DDL"></a>查询DDL</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show create table 表名</span><br><span class="line">-- 也可以看到存储引擎</span><br></pre></td></tr></table></figure>

<h4 id="更改存储引擎"><a href="#更改存储引擎" class="headerlink" title="更改存储引擎"></a>更改存储引擎</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 ENGINE MyISAM;</span><br></pre></td></tr></table></figure>

<h4 id="创建唯一索引时存在重复字段"><a href="#创建唯一索引时存在重复字段" class="headerlink" title="创建唯一索引时存在重复字段"></a>创建唯一索引时存在重复字段</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">alter ignore table 表名 add unique index uk_uid(uid);</span><br><span class="line">-- 会把重复的数据进行丢弃</span><br><span class="line">类似于insert ignore into ...</span><br><span class="line">注意:如果是5.7以及以上的版本,没有这个语法了</span><br><span class="line">如果是5.6以下,要在MyIsam进行操作,之后再切回来,而且要把全局变量@@old_alter_table改成1, 并且提前把session变量改成0,保证主从备份</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/alter-table.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/alter-table.html</a></p>
<p><a href="https://dev.mysql.com/doc/refman/5.6/en/alter-table.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.6/en/alter-table.html</a></p>
<p>5.7和5.6官方文档的对比</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/09/11/mysql的一些命令/" data-id="ck0fd8mng0003a4iwp93hj3kk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2019/09/11/test/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">test</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/09/11/mysql的一些命令/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/09/11/test/">test</a>
          </li>
        
          <li>
            <a href="/2019/09/11/tomcat总体框架/">tomcat总体框架</a>
          </li>
        
          <li>
            <a href="/2019/09/11/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Swen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>